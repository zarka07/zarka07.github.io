"use strict";(self["webpackChunkvue3"]=self["webpackChunkvue3"]||[]).push([[479],{2863:function(e,t,s){s.r(t),s.d(t,{default:function(){return Y}});var i=s(3396),r=s(9242),n=s(7139);const o=e=>((0,i.dD)("data-v-1060fd95"),e=e(),(0,i.Cn)(),e),a={key:0,class:"p-4 record"},l=o((()=>(0,i._)("div",{class:""},[(0,i._)("h3",null,"New item")],-1))),c=o((()=>(0,i._)("hr",null,null,-1))),u={class:"pb-2"},d=o((()=>(0,i._)("option",{disabled:""},"Categories:",-1))),m=["value"],p=o((()=>(0,i._)("br",null,null,-1))),h=o((()=>(0,i._)("label",{for:"selectCategory",class:"chooseCategory"},"Choose the category",-1))),y={class:"radio pb-2"},g=o((()=>(0,i._)("span",{class:"mx-2"},"Income",-1))),v=o((()=>(0,i._)("span",{class:"mx-2"},"Expenses",-1))),w={class:"summ"},_={key:0,class:"text-danger errors"},b={key:0},k={class:"mt-4 _description"},$={key:0,class:"text-danger errors"},f={key:0},C=o((()=>(0,i._)("div",{class:"mt-4"},[(0,i._)("button",{type:"submit",class:"btn btn-success shadow-sm rounded"},[(0,i.Uk)(" CREATE "),(0,i._)("i",{class:"bi bi-send float-end ms-2"})])],-1))),D={key:1,class:"text-center m-4 p-4 col-xl-12 col-lg-12 col-md-12 col-sm-12 flex-wrap"},S=(0,i.Uk)(" You didn't add categories. "),U=(0,i.Uk)("Add new");function x(e,t,s,o,x,E){const q=(0,i.up)("router-link");return E.categories.length?((0,i.wg)(),(0,i.iD)("div",a,[l,c,(0,i._)("form",{class:"newItem",onSubmit:t[5]||(t[5]=(0,r.iM)(((...e)=>E.onSubmit&&E.onSubmit(...e)),["prevent"]))},[(0,i._)("div",u,[(0,i.wy)((0,i._)("select",{id:"selectCategory","onUpdate:modelValue":t[0]||(t[0]=e=>x.current=e),placeholder:"Choose category"},[d,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(E.categories,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e.id,value:e.id},(0,n.zw)(e.categoryName),9,m)))),128))],512),[[r.bM,x.current]]),p,h]),(0,i._)("div",y,[(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{class:"","onUpdate:modelValue":t[1]||(t[1]=e=>x.type=e),name:"type",type:"radio",value:"income"},null,512),[[r.G2,x.type]]),g]),(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{class:"","onUpdate:modelValue":t[2]||(t[2]=e=>x.type=e),name:"type",type:"radio",value:"outcome"},null,512),[[r.G2,x.type]]),v])]),(0,i._)("div",w,[(0,i.wy)((0,i._)("input",{id:"summ","onUpdate:modelValue":t[3]||(t[3]=e=>x.summ=e),type:"number",placeholder:"Summ"},null,512),[[r.nr,x.summ,void 0,{number:!0}]]),o.v$.$invalid?((0,i.wg)(),(0,i.iD)("div",_,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.v$.$silentErrors,(e=>((0,i.wg)(),(0,i.iD)("span",{class:"error",key:e.uid},["summ"===e.$property?((0,i.wg)(),(0,i.iD)("i",b,(0,n.zw)(e.$message),1)):(0,i.kq)("",!0)])))),128))])):(0,i.kq)("",!0)]),(0,i._)("div",k,[(0,i.wy)((0,i._)("input",{id:"description","onUpdate:modelValue":t[4]||(t[4]=e=>x.description=e),type:"text",placeholder:"Description"},null,512),[[r.nr,x.description]]),o.v$.$invalid?((0,i.wg)(),(0,i.iD)("div",$,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.v$.$silentErrors,(e=>((0,i.wg)(),(0,i.iD)("span",{class:"error",key:e.uid},["description"===e.$property?((0,i.wg)(),(0,i.iD)("i",f,(0,n.zw)(e.$message),1)):(0,i.kq)("",!0)])))),128))])):(0,i.kq)("",!0)]),C],32)])):((0,i.wg)(),(0,i.iD)("p",D,[S,(0,i.Wm)(q,{to:"/categories"},{default:(0,i.w5)((()=>[U])),_:1})]))}var E=s(5635),q=s(3053),B=s(9117),I={name:"record-component",setup(){const e=(0,E.S)();return{crmStore:e,v$:(0,q.ZP)()}},data(){return{current:{},type:"income",summ:1,description:""}},validations(){return{summ:{required:B.C1,between:(0,B.vX)(1,1e6)},description:{required:B.C1,minLength:(0,B.Ei)(3)}}},mounted(){this.categories.length&&(this.current=this.categories[0].id)},computed:{userBill(){return this.crmStore.GET_USER_BILL},categories(){return this.crmStore.categories},canCreateRecord(){return"income"===this.type||this.userBill>=this.summ}},methods:{async onSubmit(){if(!this.v$.$invalid)if(this.canCreateRecord){const t={selectedCategoryId:this.current,type:this.type,summ:this.summ,description:this.description,date:(new Date).toJSON().slice(0,19)};try{await this.crmStore.createRecord(t).then((e=>{this.$toast.success(`New ${e} has been created!`)})),this.summ=1,this.description="";const e="income"===this.type?this.userBill+this.summ:this.userBill-this.summ;await this.crmStore.updateUserInfo(e),this.v$.$reset()}catch(e){this.$toast.warning(e.message)}}else this.$toast.error("You haven't enough money: -"+(this.summ-this.userBill))}}},R=s(89);const V=(0,R.Z)(I,[["render",x],["__scopeId","data-v-1060fd95"]]);var Y=V}}]);
//# sourceMappingURL=Record.vue.6337e0cf.js.map